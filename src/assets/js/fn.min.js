
function formValidate(b){var a=$("#"+b).validate({highlight:function(c){$(c).closest(".form-group").addClass("has-error")},unhighlight:function(c){$(c).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(c,d){if(d.parent(".input-group").length){c.insertAfter(d.parent())}else{c.insertAfter(d)}}});return a}function formReset(a){if($("#"+a).length>0){$("#"+a)[0].reset();$("#"+a+" .form-group").removeClass("has-error");$("#"+a).validate().resetForm()}}function showAppLoading(){$(".app-loading").addClass("open")}function hideAppLoading(){$(".app-loading").removeClass("open")}function tableRefesh(b){var a=[];$(b+" .table-content thead tr:first-child th").each(function(c,d){a.push($(this).width())});a.pop();$(b+" .table-header thead tr:first-child th").each(function(c,d){$(this).width(a[c])})}ko.components.register("form-signin",{viewModel:function(b){var a=this;a.params=b;a.notify=ko.observable("");a.signin=function(){$("#form-signin .btn").prop("disabled",true);$.post("login",$("#form-signin").serialize()).done(function(c){$("#form-signin .btn").prop("disabled",false);if(c.status==="success"){window.location.reload()}else{a.notify('<div class="alert alert-danger" role="alert">'+c.message+"</div>")}});return false};$("#form-signin .form-control").on("keyup",function(){a.notify("")})},template:'<div class="container">        <div class="panel panel-default panel-signin">            <div class="panel-body">                <form data-bind="submit: signin" class="form-signin" id="form-signin" method="POST">                    <input type="hidden" name="_token" data-bind="value: params.token">                    <img data-bind="attr:{src: params.logo}" class="img-responsive" style="margin: 5px auto 20px auto;"/>                    <div data-bind="html: notify"></div>                    <input type="text" id="username" name="username" class="form-control" data-bind="attr:{placeholder: params.labels.username}" required autofocus>                    <input type="password" id="password" name="password" class="form-control" data-bind="attr:{placeholder: params.labels.password}" required>                    <div class="checkbox">                        <label>                            <input type="checkbox" name="remember-me" value="true"> <span data-bind="html: params.labels.remember_me"></span>                        </label>                    </div>                    <button data-bind="attr:{class: \'btn btn-lg btn-block btn-\' + params.type}, html: params.labels.login" type="submit"></button>                </form>            </div>        </div>    </div>'});ko.components.register("grid",{viewModel:function(b){var a=this;a.token=b.token;a.url=b.url;a.labels=$.map(b.cols,function(d,c){return d});a.cols=$.map(b.cols,function(d,c){return c});a.data_empty_label=b.data_empty_label;a.sizes=[10,20,50,100,200,500];a.total=ko.observable(0);a.rows=ko.observableArray([]);a.ids=ko.observableArray([]);a.pagenum=ko.observable(1);a.pagesize=ko.observable(10);a.search=ko.observable("");a.sorts=b.sorts;a.sortdatafield=ko.observable("");a.sortorder=ko.observable(0);a.groupby=ko.observable(b.groupby===undefined?"":b.groupby);a.filters=ko.observableArray([]);a.display=ko.observable(false);a.loading=ko.observable(false);a.is_fetch=false;a.pagemax=ko.pureComputed(function(){return Math.max(Math.ceil(a.total()/a.pagesize()),1)});a.setSize=function(c){if(a.pagesize()!==c){a.pagenum(1);a.pagesize(c)}};a.start=ko.pureComputed(function(){return a.pagesize()*(a.pagenum()-1)+1});a.end=ko.pureComputed(function(){return Math.min(a.pagesize()*a.pagenum(),a.total())});a.next=function(){a.pagenum(a.pagenum()+1)};a.prev=function(){a.pagenum(a.pagenum()-1)};a.del=function(){$("#cfmDel").modal("show")};a.sort=function(d){if(d!==a.sortdatafield()){a.sortdatafield(d)}else{var c=a.sortorder()+1;if(c>1){c=-1}a.sortorder(c)}};a.toogleAll=function(){if(a.checkAll()){a.ids([])}else{if(a.groupby()===""){var c=[];ko.utils.arrayForEach(a.rows(),function(d){c.push(d.id)});a.ids(c)}else{var c=[];ko.utils.arrayForEach(a.rows(),function(d){ko.utils.arrayForEach(d.rows,function(e){c.push(e.id)})});a.ids(c)}}return true};a.checkAll=ko.pureComputed(function(){if(a.groupby()===""){return(a.ids().length===a.rows().length)}else{var c=0;ko.utils.arrayForEach(a.rows(),function(d){c+=d.total});return a.ids().length===c}},a);a.showLoading=function(){a.loading(true)};a.hideLoading=function(){a.loading(false)};a.doSearch=function(c){a.search($("#"+c).val())};a.clearSearch=function(c){$("#"+c).val("");a.search("")};a.fetch=function(){if(a.is_fetch){return true}a.is_fetch=true;$.ajax({url:a.url,type:"post",data:{_token:a.token,pagenum:a.pagenum,pagesize:a.pagesize,search:a.search,sort:a.sortdatafield,order:a.sortorder,groupby:a.groupby,filters:a.filters},beforeSend:a.showLoading,complete:a.hideLoading,success:function(c){a.rows(c.rows);a.total(c.total);a.is_fetch=false;tableRefesh("#app-grid")}})};a.edit=function(c){b.edit(c)};a.doDel=function(){$.ajax({url:a.url,type:"post",data:{_token:a.token,ids:JSON.stringify(a.ids())},beforeSend:showAppLoading,complete:hideAppLoading,success:function(c){toastr[c.status](c.message);if(c.status==="success"){a.ids([]);a.fetch()}}})};b.callback(a);ko.computed(a.fetch);$("#app-grid .wrap-scroll").css("height",$(window).height()-135);$(window).resize(function(){$("#app-grid .wrap-scroll").css("height",$(window).height()-135);tableRefesh("#app-grid")})},template:'<div class="table-header-fixed-top" id="app-grid" data-bind="visible: display" style="display: none;">        <table class="table table-header">            <thead>                <tr>                    <th width="30px"><input type="checkbox" data-bind="click: toogleAll,checked: checkAll"/></th>                    <!--ko foreach: {data: labels, as: \'labels\' }-->                         <!--ko if: $parent.groupby()===\'\' || $parent.cols[$index()] !== $parent.groupby() -->                            <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) < 0 -->                                 <th><span data-bind="html: $parent.cols[$index()]"></span></th>                            <!--/ko-->                            <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) >= 0 -->                                 <th class="sortdatafield" data-bind="click: $parent.sort.bind($data, $parent.cols[$index()])"><span data-bind="html: $data"></span> <span data-bind="attr: {class: $parent.sortdatafield() != $parent.cols[$index()] || $parent.sortorder()==0 ? \'sort\' : $parent.sortorder()==1 ? \'sortasc\' : \'sortdesc\'}"></span></th>                            <!--/ko-->                        <!--/ko-->                    <!--/ko-->                    <th></th>                </tr>             </thead>        </table>        <div class="grid-container loading-container wrap-scroll">            <div class="loading" data-bind="attr: {class: loading() ? \'loading open\' : \'loading\'}"><span class="glyphicon glyphicon-refresh glyphicon-spin"></span></div>            <table class="table table-hover table-content table-striped thead-hide">                <thead>                    <tr>                        <th width="30px"><input type="checkbox" data-bind="click: toogleAll,checked: ids().length===rows().length"/></th>                        <!--ko foreach: {data: labels, as: \'labels\' }-->                             <!--ko if: $parent.groupby()===\'\' || $parent.cols[$index()] !== $parent.groupby() -->                                <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) < 0 -->                                     <th><span data-bind="html: $parent.cols[$index()]"></span></th>                                <!--/ko-->                                <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) >= 0 -->                                     <th class="sortdatafield" data-bind="click: $parent.sort.bind($data, $parent.cols[$index()])"><span data-bind="html: $data"></span> <span data-bind="attr: {class: $parent.sortdatafield() != $parent.cols[$index()] || $parent.sortorder()==0 ? \'sort\' : $parent.sortorder()==1 ? \'sortasc\' : \'sortdesc\'}"></span></th>                                <!--/ko-->                            <!--/ko-->                        <!--/ko-->                        <th></th>                    </tr>                </thead>                <tbody>                    <!--ko if: groupby()===\'\'-->                        <!--ko foreach: {data: rows, as: \'row\'}-->                            <tr data-bind="attr: {\'class\': $parent.ids().indexOf(id)>=0 ? \'active\':\'\'}">                                <td>                                    <input type="checkbox" data-bind="checkedValue: id,checked: $parent.ids"/>                                </td>                               <!--ko foreach: $parent.cols-->                               <td>                                   <span data-bind="html: row[$data]"></span>                               </td>                               <!--/ko-->                               <td class="text-right actions">                                   <button class="btn btn-default btn-sm" data-bind="click: $parent.edit"><span class="glyphicon glyphicon-edit"></span></button>                               </td>                            </tr>                        <!--/ko-->                    <!--/ko-->                    <!--ko if: groupby()!==\'\'-->                        <!--ko foreach: {data: rows, as: \'row\'}-->                            <!--ko if: row.rows!==undefined-->                                <tr class="group-header">                                    <td data-bind="attr:{colspan: $parent.cols.length + 1}">                                        <span data-bind="html: row[$parent.groupby()]"></span> <span data-bind="html: row.total" class="label label-default"></span>                                    </td>                                </tr>                                <!--ko foreach: {data: row.rows, as: \'row_group\'}-->                                    <tr data-bind="attr: {\'class\': $parents[1].ids().indexOf(row_group.id)>=0 ? \'active\':\'\'}">                                        <td>                                            <input type="checkbox" data-bind="checkedValue: row_group.id,checked: $parents[1].ids"/>                                        </td>                                       <!--ko foreach: $parents[1].cols-->                                            <!--ko if: $parents[2].cols[$index()] !== $parents[2].groupby() -->                                                <td>                                                    <span data-bind="html: row_group[$data]"></span>                                                </td>                                            <!--/ko-->                                       <!--/ko-->                                       <td class="text-right actions">                                           <button class="btn btn-default btn-sm" data-bind="click: $parents[1].edit"><span class="glyphicon glyphicon-edit"></span></button>                                       </td>                                    </tr>                                <!--/ko-->                            <!--/ko-->                        <!--/ko-->                    <!--/ko-->                    <tr data-bind="visible: rows().length==0 " style="display: none;">                        <td data-bind="attr: {colspan: cols.length + 2}, html: data_empty_label" class="text-center active"></td>                    </tr>                </tbody>           </table>        </div>    </div>'});