
Number.prototype.formatMoney=function(l,h,e,g){var k=this,l=isNaN(l=Math.abs(l))?0:l,h=h==undefined?".":h,e=e==undefined?",":e,f=k<0?"-":"",b=parseInt(k=Math.abs(+k||0).toFixed(l))+"",a=(a=b.length)>3?a%3:0,g=g==undefined?"VNĐ":g;return f+(a?b.substr(0,a)+e:"")+b.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+e)+(l?h+Math.abs(k-b).toFixed(l).slice(2):"")+" "+g};String.prototype.str_pad=function(a,c,b){if(c==="undefined"){c=" "}if(b==="undefined"){b="STR_PAD_RIGHT"}var d=this+"";switch(b){case"STR_PAD_RIGHT":while(d.length<a){d=d+c}break;case"STR_PAD_LEFT":while(d.length<a){d=c+d}break;case"STR_PAD_BOTH":while(d.length<a){d=d+c;if(d.length<a){d=c+d}}break}return d};String.prototype.strtotime=function(e){var c=new Date(this);if(c.toString()==="Invalid Date"){return this}var b=e.length;var a="";for(var d=0;d<b;d++){switch(e[d]){case"Y":a+=c.getFullYear();break;case"m":a+=String(c.getMonth()+1).str_pad(2,"0","STR_PAD_LEFT");break;case"d":a+=String(c.getDate()).str_pad(2,"0","STR_PAD_LEFT");break;case"H":a+=String(c.getHours()).str_pad(2,"0","STR_PAD_LEFT");break;case"i":a+=String(c.getMinutes()).str_pad(2,"0","STR_PAD_LEFT");break;case"s":a+=String(c.getSeconds()).str_pad(2,"0","STR_PAD_LEFT");break;default:a+=e[d]}}return a};function formValidate(b){var a=$("#"+b).validate({highlight:function(c){$(c).closest(".form-group").addClass("has-error")},unhighlight:function(c){$(c).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(c,d){if(d.parent(".input-group").length){c.insertAfter(d.parent())}else{c.insertAfter(d)}}});return a}function formReset(a){if($("#"+a).length>0){$("#"+a)[0].reset();$("#"+a+" .form-group").removeClass("has-error");$("#"+a).validate().resetForm()}}function showAppLoading(){$(".app-loading").addClass("open")}function hideAppLoading(){$(".app-loading").removeClass("open")}function tableRefesh(b){var a=[];$(b+" .table-content thead tr:first-child th").each(function(c,d){a.push($(this).width())});a.pop();$(b+" .table-header thead tr:first-child th").each(function(c,d){$(this).width(a[c])})}function dropdown(a,b){if($("#"+a).hasClass("open")){$("#"+a).removeClass("open")}else{$("#"+a).addClass("open")}}function printDiv(e,d){var b=document.getElementById(e);var a=window.open("","Print-Window");var c=b.innerHTML;a.document.open();a.document.write('<html><body onload="window.print()">'+c+"</body></html>");a.document.close();setTimeout(function(){a.close();d()},3)}ko.components.register("form-signin",{viewModel:function(c){var a=this;a.params=c;a.notify=ko.observable("");a.expired=ko.observable(false);var b;a.signin=function(){if(c.captcha===undefined){$("#form-signin .btn").prop("disabled",true);$.post("login",$("#form-signin").serialize()).done(function(d){$("#form-signin .btn").prop("disabled",false);if(d.status==="success"){window.location.reload()}else{a.notify('<div class="alert alert-danger" role="alert">'+d.message+"</div>")}})}else{a.expired(true);b=grecaptcha.render(c.captcha.id,{sitekey:c.captcha.sitekey,theme:c.captcha.theme,type:c.captcha.type,size:c.captcha.size,tabindex:c.captcha.tabindex,"expired-callback":function(){a.expired(false)},callback:function(){$.post("login",$("#form-signin").serialize()+"&responseCaptcha="+grecaptcha.getResponse(b)).done(function(d){$("#form-signin .btn").prop("disabled",false);if(d.status==="success"){window.location.reload()}else{a.expired(false);a.notify('<div class="alert alert-danger" role="alert">'+d.message+"</div>")}})}})}return false};$("#form-signin .form-control").on("keyup",function(){a.notify("")})},template:'<div class="container">        <div class="panel panel-default panel-signin">            <div class="panel-body">                <form data-bind="submit: signin" class="form-signin" id="form-signin" method="POST">                    <input type="hidden" name="_token" data-bind="value: params.token">                    <img data-bind="attr:{src: params.logo}" class="img-responsive" style="margin: 5px auto 20px auto;"/>                    <div data-bind="html: notify"></div>                    <div data-bind="visible: !expired()">                        <input type="text" id="username" name="username" class="form-control" data-bind="attr:{placeholder: params.labels.username}" required autofocus>                        <input type="password" id="password" name="password" class="form-control" data-bind="attr:{placeholder: params.labels.password}" required>                        <div class="checkbox">                            <label>                                <input type="checkbox" name="remember-me" value="true"> <span data-bind="html: params.labels.remember_me"></span>                            </label>                        </div>                        <button data-bind="attr:{class: \'btn btn-lg btn-block btn-\' + params.type}, html: params.labels.login" type="submit"></button>                    </div>                    <div data-bind="if: expired()">                        <div style="margin-top: 40px;" data-bind="css: params.captcha.class, attr: { id: params.captcha.id }"></div>                    </div>                </form>            </div>        </div>    </div>'});ko.components.register("grid",{viewModel:function(b){var a=this;a.params=b;a.token=b.token;a.url=b.url;a.labels=$.map(b.cols,function(d,c){return d});a.trans=b.trans;a.buttons=b.buttons;a.cols=$.map(b.cols,function(d,c){return c});a.data_empty_label=b.data_empty_label;a.sizes=[5,10,25,50,100,200,500];a.total=ko.observable(0);a.rows=ko.observableArray([]);a.ids=ko.observableArray([]);a.pagenum=1;a.pagesize=25;a.search=ko.observable("");a.sorts=b.sorts;a.sortdatafield=ko.observable("");a.sortorder=ko.observable(0);a.groupby=ko.observable(b.groupby===undefined?"":b.groupby);a.filters=ko.observableArray([]);a.loading=ko.observable(false);a.is_fetch=false;a.pagemax=ko.pureComputed(function(){return Math.max(Math.ceil(a.total()/a.pagesize),1)});a.computed_pagenum=ko.observable(a.pagenum);a.computed_pagesize=ko.observable(a.pagesize);a.setPageNum=function(c){a.pagenum=c;a.computed_pagenum(c)};a.setPageSize=function(c){a.pagesize=c;a.computed_pagesize(c)};a.setSize=function(c){if(a.pagesize!==c){a.setPageNum(1);a.setPageSize(c);a.fetch()}};a.start=ko.pureComputed(function(){return a.computed_pagesize()*(a.computed_pagenum()-1)+1});a.end=ko.pureComputed(function(){return Math.min(a.computed_pagesize()*a.computed_pagenum(),a.total())});a.next=function(){a.setPageNum(a.pagenum+1);a.fetch()};a.prev=function(){a.setPageNum(a.pagenum-1);a.fetch()};a.del=function(){$("#cfmDel").modal("show")};a.sort=function(d){if(d!==a.sortdatafield()){a.sortdatafield(d)}else{var c=a.sortorder()+1;if(c>1){c=-1}a.sortorder(c)}};a.toogleAll=function(){if(a.checkAll()){a.ids([])}else{if(a.groupby()===""){var c=[];ko.utils.arrayForEach(a.rows(),function(d){c.push(d.id)});a.ids(c)}else{var c=[];ko.utils.arrayForEach(a.rows(),function(d){ko.utils.arrayForEach(d.rows,function(e){c.push(e.id)})});a.ids(c)}}return true};a.checkAll=ko.pureComputed(function(){if(a.groupby()===""){return(a.ids().length===a.rows().length)}else{var c=0;ko.utils.arrayForEach(a.rows(),function(d){c+=d.total});return a.ids().length===c}},a);a.showLoading=function(){a.loading(true)};a.hideLoading=function(){a.loading(false)};a.doSearch=function(d,c){if(a.is_fetch){return true}a.search($(c.target).val())};a.clearSearch=function(d,c){$(c.target).parent().children("input").val("");a.search("")};a.search.subscribe(function(c){a.setPageNum(1)},a,"beforeChange");a.filters.subscribe(function(c){a.setPageNum(1)},a,"beforeChange");a.groupby.subscribe(function(c){a.setPageNum(1);a.rows([])},a,"beforeChange");a.fetch=function(){a.is_fetch=true;$.ajax({url:a.url,type:"post",data:{_token:a.token,pagenum:a.pagenum,pagesize:a.pagesize,search:a.search,sort:a.sortdatafield,order:a.sortorder,groupby:a.groupby,filters:a.filters()},beforeSend:a.showLoading,complete:a.hideLoading,success:function(c){a.rows(c.rows);a.total(c.total);a.is_fetch=false;tableRefesh("#app-grid")}})};a.add=function(){if(b.add!==undefined){b.add()}};a.edit=function(c){if(b.edit!==undefined){b.edit(c)}};a.ref=function(){if(a.is_fetch){return true}a.fetch()};a.doDel=function(){$.ajax({url:a.url+"/delete",type:"post",data:{_token:a.token,ids:JSON.stringify(a.ids())},beforeSend:showAppLoading,complete:hideAppLoading,success:function(c){toastr[c.status](c.message);if(c.status==="success"){a.ids([]);a.fetch()}}})};if(b.callback!==undefined){b.callback(a)}ko.computed(a.fetch);if(b.height==undefined){$("#app-grid .wrap-scroll").css("height",$(window).height()-135);$(window).resize(function(){$("#app-grid .wrap-scroll").css("height",$(window).height()-135);tableRefesh("#app-grid")})}else{$("#app-grid .wrap-scroll").css("height",b.height);$(window).resize(function(){$("#app-grid .wrap-scroll").css("height",b.height);tableRefesh("#app-grid")})}},template:'    <nav class="navbar navbar-default">        <div class="container-fluid">            <div class="app-toolbar">                <div class="pull-left">                    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">                        <!-- ko if: buttons.indexOf("add") !== -1 -->                            <button data-bind="click: add" type="button" class="btn btn-default" ><span class="glyphicon glyphicon-plus"></span> <span data-bind="html: trans.add"></span></button>                        <!--/ko-->                        <button data-bind="click: ref, attr:{title: trans.refresh}" type="button" class="btn btn-default" data-toggle="tooltip"><span class="glyphicon glyphicon-refresh"></span></button>                        <!-- ko if: buttons.indexOf("delete") !== -1 -->                        <button data-bind="click: del, visible: ids().length>0, attr:{title: trans.delete}" type="button" class="btn btn-danger" data-toggle="tooltip"><span class="glyphicon glyphicon-trash"></span></button>                        <!--/ko-->                        <!-- ko if: params.leftToolbar !== undefined -->                            <div class="pull-left" data-bind="template: {name: params.leftToolbar }"></div>                        <!-- /ko -->                    </div>                </div>                <div class="pull-right">                    <div class="pagination" style="float:left;" data-bind="visible: total() > 0">                        <span><b data-bind="html: start"></b>-<b data-bind="html: end"></b> <span data-bind="html: trans.pagination_of_total"></span> <b data-bind="html: total"></b></span>                        <div class="btn-group" role="group">                            <button type="button" class="btn btn-default" data-bind="click: prev, enable: computed_pagenum()>1"><span class="glyphicon glyphicon-chevron-left"></span></button>                            <button type="button" class="btn btn-default" data-bind="click: next, enable: computed_pagenum()<pagemax()"><span class="glyphicon glyphicon-chevron-right"></span></button>                        </div>                        <div class="btn-group" style="margin-right: 5px;">                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">                                <span data-bind="text: computed_pagesize"></span>                                <span class="caret"></span>                            </button>                            <ul class="dropdown-menu">                                <!--ko foreach: sizes-->                                    <!-- ko if: $parent.sizes[$index() -1 ] <= $parent.total() || $index()==0 -->                                    <li data-bind="click: $parent.setSize, attr: {class: $parent.computed_pagesize() === $data ? \'active\':\'\'}"><a data-bind="text: $data"></a></li>                                    <!--/ko-->                                <!--/ko-->                            </ul>                        </div>                    </div>                    <div id="search-wrap" style="float:right;">                        <input type="text" class="form-control" data-bind="attr: {placeholder: trans.search}, event: {keyup: doSearch} ">                        <i id="search-clear" class="glyphicon glyphicon-remove" data-bind="click: clearSearch, attr: {\'data-toggle\': search()!=\'\'}"></i>                    </div>                </div>            </div>        </div>    </nav>    <div class="table-header-fixed-top" id="app-grid" >        <table class="table table-header">            <thead>                <tr>                    <th width="30px"><input type="checkbox" data-bind="click: toogleAll,checked: checkAll"/></th>                    <!--ko foreach: {data: labels, as: \'labels\' }-->                         <!--ko if: $parent.groupby()===\'\' || $parent.cols[$index()] !== $parent.groupby() -->                            <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) < 0 -->                                 <th><span data-bind="html: $data"></span></th>                            <!--/ko-->                            <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) >= 0 -->                                 <th class="sortdatafield" data-bind="click: $parent.sort.bind($data, $parent.cols[$index()])"><span data-bind="html: $data"></span> <span data-bind="attr: {class: $parent.sortdatafield() != $parent.cols[$index()] || $parent.sortorder()==0 ? \'sort\' : $parent.sortorder()==1 ? \'sortasc\' : \'sortdesc\'}"></span></th>                            <!--/ko-->                        <!--/ko-->                    <!--/ko-->                    <th></th>                </tr>             </thead>        </table>        <div class="grid-container loading-container wrap-scroll">            <div class="loading" data-bind="attr: {class: loading() ? \'loading open\' : \'loading\'}"><span class="glyphicon glyphicon-refresh glyphicon-spin"></span></div>            <table class="table table-hover table-content table-striped thead-hide">                <thead>                    <tr>                        <th width="30px"><input type="checkbox" data-bind="click: toogleAll,checked: ids().length===rows().length"/></th>                        <!--ko foreach: {data: labels, as: \'labels\' }-->                             <!--ko if: $parent.groupby()===\'\' || $parent.cols[$index()] !== $parent.groupby() -->                                <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) < 0 -->                                     <th data-bind="attr: {style: $parent.params.columnsresize!==undefined &&  $parent.params.columnsresize[$parent.cols[$index()]] !== undefined ? \'width:\'+$parent.params.columnsresize[$parent.cols[$index()]]+\'px;\':\'\'}"><span data-bind="html: $data"></span></th>                                <!--/ko-->                                <!--ko if: $parent.sorts.indexOf($parent.cols[$index()]) >= 0 -->                                     <th data-bind="attr: {style: $parent.params.columnsresize!==undefined &&  $parent.params.columnsresize[$parent.cols[$index()]] !== undefined ? \'width:\'+$parent.params.columnsresize[$parent.cols[$index()]]+\'px;\':\'\'}" class="sortdatafield" data-bind="click: $parent.sort.bind($data, $parent.cols[$index()])"><span data-bind="html: $data"></span> <span data-bind="attr: {class: $parent.sortdatafield() != $parent.cols[$index()] || $parent.sortorder()==0 ? \'sort\' : $parent.sortorder()==1 ? \'sortasc\' : \'sortdesc\'}"></span></th>                                <!--/ko-->                            <!--/ko-->                        <!--/ko-->                        <th></th>                    </tr>                </thead>                <tbody>                    <!--ko if: groupby()===\'\'-->                        <!--ko foreach: {data: rows, as: \'row\'}-->                            <tr data-bind="attr: {\'class\': $parent.ids().indexOf(id)>=0 ? \'active\':\'\'}">                                <td>                                    <input type="checkbox" data-bind="checkedValue: id,checked: $parent.ids"/>                                </td>                               <!--ko foreach: $parent.cols-->                               <td>                                    <!-- ko if: $parents[1].params.cellsrenderer[$data] === undefined -->                                    <span data-bind="html: row[$data]"></span>                                    <!-- /ko -->                                    <!-- ko if: $parents[1].params.cellsrenderer[$data] !== undefined -->                                    <span data-bind="html: $parents[1].params.cellsrenderer[$data](row)"></span>                                    <!-- /ko -->                               </td>                               <!--/ko-->                               <td class="text-right actions">                                    <!-- ko if: $parent.buttons.indexOf("edit") !== -1 -->                                        <!-- ko if: $parent.params.editToolbar !== undefined -->                                            <div data-bind="template: {name: $parent.params.editToolbar }"></div>                                        <!-- /ko -->                                        <!-- ko if: $parent.params.editToolbar === undefined -->                                            <button class="btn btn-default btn-sm" data-bind="click: $parent.edit"><span class="glyphicon glyphicon-edit"></span></button>                                        <!-- /ko -->                                    <!--/ko-->                                </td>                            </tr>                        <!--/ko-->                    <!--/ko-->                    <!--ko if: groupby()!==\'\'-->                        <!--ko foreach: {data: rows, as: \'row\'}-->                            <!--ko if: row.rows!==undefined-->                                <tr class="group-header">                                    <td data-bind="attr:{colspan: $parent.cols.length + ($parent.cols.indexOf($parent.groupby()) < 0 ? 2:1) }">                                        <!-- ko if: $parent.params.cellsrenderer[$parent.groupby()] === undefined -->                                        <span data-bind="html: row[$parent.groupby()]"></span> <span data-bind="html: row.total" class="label label-default"></span>                                        <!-- /ko -->                                        <!-- ko if: $parent.params.cellsrenderer[$parent.groupby()] !== undefined -->                                        <div data-bind="html: $parent.params.cellsrenderer[$parent.groupby()](row)"></div>                                        <!-- /ko -->                                    </td>                                </tr>                                <!--ko foreach: {data: row.rows, as: \'row_group\'}-->                                    <tr data-bind="attr: {\'class\': $parents[1].ids().indexOf(row_group.id)>=0 ? \'active\':\'\'}">                                        <td>                                            <input type="checkbox" data-bind="checkedValue: row_group.id,checked: $parents[1].ids"/>                                        </td>                                       <!--ko foreach: $parents[1].cols-->                                            <!--ko if: $parents[2].cols[$index()] !== $parents[2].groupby() -->                                                <td>                                                    <!-- ko if: $parents[2].params.cellsrenderer[$data] === undefined -->                                                    <span data-bind="html: row_group[$data]"></span>                                                    <!-- /ko -->                                                    <!-- ko if: $parents[2].params.cellsrenderer[$data] !== undefined -->                                                    <span data-bind="html: $parents[2].params.cellsrenderer[$data](row_group)"></span>                                                    <!-- /ko -->                                                </td>                                            <!--/ko-->                                       <!--/ko-->                                        <td class="text-right actions">                                            <!-- ko if: $parents[1].buttons.indexOf("edit") !== -1 -->                                                <!-- ko if: $parents[1].params.editToolbar !== undefined -->                                                    <div data-bind="template: {name: $parents[1].params.editToolbar }"></div>                                                <!-- /ko -->                                                <!-- ko if: $parents[1].params.editToolbar === undefined -->                                                    <button class="btn btn-default btn-sm" data-bind="click: $parents[1].edit"><span class="glyphicon glyphicon-edit"></span></button>                                                <!-- /ko -->                                            <!--/ko-->                                        </td>                                    </tr>                                <!--/ko-->                            <!--/ko-->                        <!--/ko-->                    <!--/ko-->                    <tr data-bind="visible: rows().length==0 " style="display: none;">                        <td data-bind="attr: {colspan: cols.length + 2}, html: trans.data_empty_label" class="text-center active"></td>                    </tr>                </tbody>           </table>        </div>    </div>    <!-- ko if: buttons.indexOf("delete") !== -1 -->    <!--cfmDel-->    <div class="modal" id="cfmDel" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="cfmDel" aria-hidden="true">        <div class="modal-dialog">            <div class="modal-content modal-delete">                <div class="modal-body">                    <h3 data-bind="html: trans.delete_question"></h3><br>                    <button class="btn btn-default" data-dismiss="modal" data-bind="html: trans.cancel"></button>                    <button class="btn btn-danger" data-dismiss="modal" data-bind="click: doDel, html: trans.delete"></button>                </div>            </div>        </div>    </div>    <!-- /ko -->'});ko.components.register("edit-form",{viewModel:function(b){var a=this;a.params=b;if(b.buttons===undefined){a.params.buttons=[]}a.current=ko.observable({});a.method=ko.observable("add");a.save=function(){if(!$("#frm-edit").valid()){return false}if(b.prepare_save!==undefined){b.prepare_save()}a.current()._token=b.token;$.ajax({url:b.url+"/"+a.method(),type:"post",data:a.current(),beforeSend:showAppLoading,complete:hideAppLoading,success:function(c){toastr[c.status](c.message);if(c.status=="success"){a.back();if(a.params.saved!==undefined){a.params.saved()}}}})};a.back=function(){a.current({});b.back()};a.reset=function(){a.current({})};a.form_rendered=function(){if(jQuery().tooltip!==undefined){$('[data-toggle="tooltip"]').tooltip({placement:"bottom"})}if(jQuery().popover!==undefined){$('[data-toggle="popover"]').popover({html:true})}if(b.callback!==undefined){b.callback(a)}formValidate("frm-edit")}},template:'        <nav class="navbar navbar-default">            <div class="container-fluid">                <div class="app-toolbar">                    <div class="pull-left">                        <button data-bind="click: back" type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span> Quay lại</button>                    </div>                    <!-- ko if: params.leftToolbar !== undefined -->                        <div class="pull-left" data-bind="template: {name: params.leftToolbar }"></div>                    <!-- /ko -->                    <!-- ko if: params.rightToolbar !== undefined -->                        <div class="pull-right" data-bind="template: {name: params.rightToolbar }"></div>                    <!-- /ko -->                    <!-- ko if: method()===\'add\' && params.buttons.indexOf(\'add\') >= 0 || method()===\'update\' && params.buttons.indexOf(\'edit\') >= 0-->                    <div class="pull-right">                        <button data-bind="click: reset" type="button" class="btn btn-default"><span class="glyphicon glyphicon-refresh"></span> Huỷ</button>                        <button data-bind="click: save" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-floppy-disk"></span> Lưu</button>                    </div>                    <!-- /ko -->                </div>            </div>        </nav>        <form id="frm-edit" style="padding: 15px;">            <div data-bind="template: {name: params.template, afterRender: form_rendered }"></div>        </form>'});ko.bindingHandlers.hotkeys={init:function(c,d,e,b,a){$.each(d(),function(f,g){$(c).on("keydown",null,g.key,function(){g.action();return false})})},update:function(c,d,e,b,a){}};